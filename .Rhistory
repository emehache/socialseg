.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
pol <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(box, reset = F)
plot(pol, col = 1:6, add = T)
box <- st_as_sf(data.table(long = 0, lat = 0),  coords = c("long", "lat"), crs = 32721) %>%
st_buffer(6)
sl <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := (long-2)^2/4+.5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl2 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := -(long+3)^2-.7] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl3 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
pol <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(box, reset = F)
plot(pol, col = 1:6, add = T)
box <- st_as_sf(data.table(long = 0, lat = 0),  coords = c("long", "lat"), crs = 32721) %>%
st_buffer(6)
sl <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := (long-2)^2/4+.5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl2 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := -(long+4)^2-.7] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl3 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
pol <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(box, reset = F)
plot(pol, col = 1:6, add = T)
box <- st_as_sf(data.table(long = 0, lat = 0),  coords = c("long", "lat"), crs = 32721) %>%
st_buffer(6)
sl <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := (long-2)^2/4+.5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl2 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := -(long+4)^2-.5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl3 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
pol <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(box, reset = F)
plot(pol, col = 1:6, add = T)
box <- st_as_sf(data.table(long = 0, lat = 0),  coords = c("long", "lat"), crs = 32721) %>%
st_buffer(6)
sl <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := (long-2)^2/4+.5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl2 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := -(long+4)^2] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl3 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
pol <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(box, reset = F)
plot(pol, col = 1:6, add = T)
box <- st_as_sf(data.table(long = 0, lat = 0),  coords = c("long", "lat"), crs = 32721) %>%
st_buffer(6)
sl <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := (long-2)^2/4] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl2 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := -(long+4)^2] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl3 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
pol <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(box, reset = F)
plot(pol, col = 1:6, add = T)
box <- st_as_sf(data.table(long = 0, lat = 0),  coords = c("long", "lat"), crs = 32721) %>%
st_buffer(6)
sl <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := (long-2)^2/4-1] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl2 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := -(long+4)^2] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl3 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
pol <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(box, reset = F)
plot(pol, col = 1:6, add = T)
box <- st_as_sf(data.table(long = 0, lat = 0),  coords = c("long", "lat"), crs = 32721) %>%
st_buffer(6)
sl <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := (long-2)^2/4] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl2 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := -(long+4)^2] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl3 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
pol <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(box, reset = F)
plot(pol, col = 1:6, add = T)
# plot(box, reset = F)
plot(pol, col = 1:6, add = T)
# plot(box, reset = F)
plot(pol, col = 1:6)
1:nrow(pol)
pol$id <- 1:nrow(pol)
ggplot(pol) +
geom_sf(aes(fill = id))
theme_set(theme_bw())
theme_set(theme_bw())
ggplot(pol) +
geom_sf(aes(fill = id))
ggplot(pol) +
geom_sf(aes(fill = factor(id)))
ggplot(pol) +
geom_sf(aes(fill = factor(id)), col = NA)
ggplot(pol) +
geom_sf(aes(fill = factor(id)))
n <- nrow(pol)
pol$id <- 1:n
set.seed(1234)
n <- nrow(pol)
pol$id <- 1:n
polygon$x <- sample(1:50, size = n)
pol$x <- sample(1:50, size = n)
ggplot(pol) +
# geom_sf(aes(fill = factor(id))) +
geom_sf(aes(fill = factor(x)))
ggplot(pol) +
# geom_sf(aes(fill = factor(id))) +
geom_sf(aes(fill = x))
ggplot(pol) +
# geom_sf(aes(fill = factor(id))) +
geom_sf(aes(fill = x)) +
scale_fill_gradient()
ggplot(pol) +
# geom_sf(aes(fill = factor(id))) +
geom_sf(aes(fill = x)) +
scale_fill_gradient2()
theme_set(theme_bw())
box <- st_as_sf(data.table(long = 0, lat = 0),  coords = c("long", "lat"), crs = 32721) %>%
st_buffer(6)
sl <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := (long-2)^2/4] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl2 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := -(long+4)^2] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl3 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
polygon <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(polygon, col = 1:6)
set.seed(1234)
n <- nrow(polygon)
polygon$id <- 1:n
polygon$x <- sample(1:50, size = n)
ggplot(polygon) +
# geom_sf(aes(fill = factor(id))) +
geom_sf(aes(fill = x)) +
scale_fill_gradient2()
distributed <- distribute(polygon, vars = "x", lx = 10)
distributed <- distribute(polygon, vars = "x", lx = 1)
distributed <- distribute(polygon, vars = "x", lx = .1)
ol
pol
st_bbox(polygon)
distribute(polygon, vars = "x", lx = 1)
distributed <- distribute(polygon, vars = "x", lx = 1)
plot(distributed)
ggplot(polygon) +
# geom_sf(aes(fill = factor(id))) +
geom_sf(aes(fill = x)) +
scale_fill_gradient2()
polygon$x <- sample(10:50, size = n)
theme_set(theme_bw())
box <- st_as_sf(data.table(long = 0, lat = 0),  coords = c("long", "lat"), crs = 32721) %>%
st_buffer(6)
sl <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := (long-2)^2/4] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl2 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := -(long+4)^2] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl3 <- data.table(long = seq(-6,6,length = 101)) %>%
.[, lat := long*2 - 5] %>%
.[] %>%
st_as_sf(coords = c("long", "lat"), crs = 32721) %>%
st_union() %>%
st_cast('LINESTRING') %>%
st_sf()
sl <- rbind(sl, sl2, sl3)
sl <- sl %>%
st_cast("MULTILINESTRING") %>%
st_union
polygon <- lwgeom::st_split(box, sl) %>%
st_collection_extract("POLYGON")
plot(polygon, col = 1:6)
set.seed(1234)
n <- nrow(polygon)
polygon$id <- 1:n
polygon$x <- sample(10:50, size = n)
ggplot(polygon) +
# geom_sf(aes(fill = factor(id))) +
geom_sf(aes(fill = x)) +
scale_fill_gradient2()
distributed <- distribute(polygon, vars = "x", lx = 1)
plot(distributed)
distributed <- distribute(polygon, vars = "x", lx = .5)
plot(distributed)
plot(distributed$grid[,"x"], reset = F)
distributed <- distribute(polygon, vars = "x", lx = .5)
plot(distributed)
distributed <- distribute(polygon, vars = "x", lx = .2)
plot(distributed)
plot(distributed$grid[,"x"], reset = F)
plot(distributed)
distributed$grid
roxygen2::roxygenise()
distributed <- distribute(polygon, vars = "x", lx = .2)
plot(distributed)
distributed <- distribute(polygon, vars = "x", lx = 1)
plot(distributed)
plot(distributed$grid[,"x"], reset = F)
distributed$grid
distributed$grid
distributed$grid %>%
as.data.table
roxygen2::roxygenise()
distributed <- distribute(polygon, vars = "x", lx = 1)
plot(distributed)
distributed$grid %>%
as.data.table
distributed <- distribute(polygon, vars = "x", lx = 1)
distributed <- distribute(polygon, vars = "x", lx = .2)
plot(distributed)
distributed$grid %>%
as.data.table
plot(distributed)
distributed$grid %>%
as.data.table
distributed <- distribute(polygon, vars = "x", lx = .2)
input
input <- polygon
vars = "x"
input$id <- 1:nrow(input)
# grid <- st_make_grid(input, cellsize = c(lx, ly), crs = st_crs(input))
grid <- st_make_grid(input, cellsize = c(lx, ly))
lx <- 1
ly <- 1
# grid <- st_make_grid(input, cellsize = c(lx, ly), crs = st_crs(input))
grid <- st_make_grid(input, cellsize = c(lx, ly))
grid <- st_intersection(grid, st_union(st_buffer(input, dist = .1)))
intersects <- st_intersects(input, grid) %>%
lapply(as.data.table) %>%
rbindlist(idcol = "id") %>%
.[, id := as.numeric(id)] %>%
setnames("V1", "i") %>%
.[]
data <- st_drop_geometry(input) %>%
as.data.table() %>%
.[, vars, with = F] %>%
.[, id := .I] %>%
.[]
distributed_data <- intersects %>%
.[, by = id, .(.N, i)] %>%
merge(data) %>%
.[ , (vars) := lapply(.SD, \(x) x/N), .SDcols = vars] %>%
.[, keyby = .(i, id), lapply(.SD, sum), .SDcols = vars] %>%
.[]
grid <- as.data.table(grid) %>%
.[, i:=1:.N] %>%
.[] %>%
merge(distributed_data) %>%
st_as_sf()
tol <- .Machine$double.eps
dd <- grid %>%
as.data.table %>%
.[, vars, with = F]
dd <- dd + tol
dd <- na.omit(dd)
M <- ncol(dd)
tot <- sum(dd)
tot_p <- rowSums(dd)
tot_m <- colSums(dd)
pi_m <- tot_m/tot
ent_p <- rowSums(-(dd/rowSums(dd))*log((dd/rowSums(dd)), base = M))
E <- -sum(pi_m * log(pi_m, base = M))
dd <- grid %>%
as.data.table %>%
.[, vars, with = F]
dd <- dd + tol
dd <- na.omit(dd)
M <- ncol(dd)
tot <- sum(dd)
tot_p <- rowSums(dd)
tot_m <- colSums(dd)
pi_m <- tot_m/tot
ent_p <- rowSums(-(dd/rowSums(dd))*log((dd/rowSums(dd)), base = M))
ent_p
pi_m
distributed <- distribute(polygon, vars = "x", lx = .2)
plot(distributed)
distributed$grid %>%
as.data.table
distributed %>%
smoothgrid(sigma = 2) %>%
plot
distributed %>%
smoothgrid(sigma = 20) %>%
plot
gridmap <- distributed
grid <- gridmap$grid
distribuido <- st_drop_geometry(grid)
distribuido <- na.omit(distribuido)
roxygen2::roxygenise()
distributed <- distribute(polygon, vars = "x", lx = .2)
plot(distributed)
distributed %>%
smoothgrid(sigma = 20) %>%
plot
distributed %>%
smoothgrid(sigma = 1) %>%
plot
plot(distributed)
distributed %>%
smoothgrid(sigma = 1) %>%
plot
plot(distributed)
distributed %>%
smoothgrid(sigma = .5) %>%
plot
distributed %>%
smoothgrid(sigma = 2) %>%
plot
distributed <- distribute(polygon, vars = "x", lx = .4)
plot(distributed)
distributed %>%
smoothgrid(sigma = 2) %>%
plot
roxygen2::roxygenise()
distributed <- distribute(polygon, vars = "x", lx = .3)
plot(distributed)
distributed %>%
smoothgrid(sigma = 2) %>%
plot
distributed$grid %>%
as.data.table
roxygen2::roxygenise()
distributed <- distribute(polygon, vars = "x", lx = .3)
plot(distributed)
distributed %>%
smoothgrid(sigma = 1) %>%
plot
distributed$grid %>%
as.data.table
